
      
language: android 
android: 
  components: 
    - build-tools-27.0.3
    - android-27
jdk:
  - openjdk8
  
addons:
  apt:
    packages:
      - git
      - make

before_cache: 
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock 
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/ 
  
cache: 
  directories: 
    - $HOME/.gradle/caches/ 
    - $HOME/.gradle/wrapper/ 
    - $HOME/.android/build-cache
  
before_deploy:
  - export VERSION=$(make travis-version)
  - export ART_DEBUG_APK="debug-${VERSION}.apk"
  - export ART_RELEASE_APK="release-${VERSION}.apk"
  - export ART_CHECKSTYLE=${VERSION}_checkstyle.html
  - export ART_LINT=${VERSION}_lint.html
  
  - mv app/build/outputs/apk/dev/debug/app-dev-debug.apk $ART_DEBUG_APK
  - mv app/build/outputs/apk/dev/release/app-dev-release-unsigned.apk $ART_RELEASE_APK
  - mv app/build/reports/checkstyle/android.html $ART_CHECKSTYLE
  - mv app/build/reports/lint-results.html $ART_LINT
  
  - git config --local user.name "Travis Bot"
  - git config --local user.email "travis@gmail.com"
  - git tag ${VERSION}

deploy:
  provider: releases
  api_key: ${DEPLOY_TOKEN}
  file: 
    - ${ART_DEBUG_APK}
    - ${ART_RELEASE_APK}
    - ${ART_CHECKSTYLE}
    - ${ART_LINT}
  skip_cleanup: true 
  prerelease: true
  on:
    branch:
      - master
      - force-build
    tags: false
    condition: $TRAVIS_PULL_REQUEST = false
